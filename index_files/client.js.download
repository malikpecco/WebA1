var templatex={};templatex.view=1;templatex.data=new Array();templatex.count1=0;templatex.count2=0;templatex.quantity=0;templatex.machid=null;templatex.scheduleid=null;templatex.resourcename=null;templatex.productid=null;templatex.productname=null;templatex.allowMulti=0;templatex.firstSlot=true;templatex.sid=null;templatex.pid=null;templatex.useCart=0;templatex.slots=new Array();templatex.firstCartLoad=true;templatex.form=null;templatex.totPrice=0;templatex.currency=null;templatex.hasQuantity=false;templatex.parent=null;templatex.mode="normal";templatex.init=function(i,b,c,f,a){this.currency=a;this.useCart=f;if(this.useCart==false){jQuery.removeCookie("bookings")}this.sid=b;this.pid=c;if(i&&jQuery("#bookings").length>0){jQuery("html, body").animate({scrollTop:jQuery("#bookings").offset().top-30},0)}var g=this;jQuery("#bookings-submit-times").button();jQuery("#bookings-submit-times").click(function(){g.addToCart()});try{var d;if(d=jQuery.parseJSON(jQuery.cookie("bookings"))){this.data=d}if(this.data.length>0){jQuery("#bookings-cart-icon").show()}}catch(h){jQuery.removeCookie("bookings")}jQuery("#bookings-cart-icon").click(function(){if(jQuery("#bookings-cart").css("display")=="none"){g.displayCart()}else{jQuery("#bookings-section-notices").hide("fold");jQuery("#bookings-cart").hide("fold");jQuery("#bookings-cart-buttons").hide("fold");jQuery("#bookings-section-checkout").hide("fold");jQuery("#bookings-section1").show("fold");jQuery("#bookings-section2").show("fold");jQuery("#bookings-calendar").show("fold")}});if(jQuery(document).getUrlParam("payact")=="cancel"){this.mode="cancel";jQuery("#bookings-cart-icon").click()}else{if(jQuery(document).getUrlParam("payact")=="return"){jQuery("#bookings-section-cart").remove();jQuery("#bookings-section1").remove();jQuery.removeCookie("bookings")}}this.getCheckoutForm();if(jQuery("#bookings-section-notices #bookings-errors").html().length>0){jQuery("#bookings-section-notices #bookings-errors").show()}if(jQuery("#bookings-section-notices #bookings-notices").html().length>0){jQuery("#bookings-section-notices #bookings-notices").show()}};templatex.checkoutForm=function(){jQuery("#bookings-cart-buttons").hide("fold");jQuery("#bookings-section-notices").hide("fold");jQuery("#bookings-checkout-form").html(this.form);jQuery("#bookings-section-checkout").show("fold")};templatex.getCheckoutForm=function(){this.form=jQuery("#bookings-checkout-form").html();var that=this;jQuery("#aphpsform input#book3-submit").click(function(){that.checkout();return false});return;var that=this;new jQuery.ajax({url:aphpsAjaxURL+"checkout",type:"post",data:{module:"bookings",bookingssid:this.sid,bookingspid:this.pid},success:function(request){try{var result=eval("("+request+")")}catch(e){throw"Could not parse JSON"}that.form=result.html;jQuery("#aphpsform input#book3-submit").click(function(){that.checkout();return false})}})};templatex.hasPricing=function(){hasPricing=false;for(var a=0;a<this.data.length;a++){if(this.data[a].price>0){hasPricing=true}}return hasPricing};templatex.checkout=function(){var that=this;var data=jQuery("#aphpsform").serializeObject();data.module="bookings";data.step="save";data.bookingssid=this.sid;data.bookingspid=this.pid;data.haspricing=this.hasPricing();data.cart=this.data;jQuery(".aphpsSpinner").show();var that=this;new jQuery.ajax({url:aphpsAjaxURL+"checkout",type:"post",data:data,success:function(request){jQuery(".aphpsSpinner").hide();try{var result=eval("("+request+")")}catch(e){throw"Could not parse JSON"}if(result.status=="pay"){jQuery("#bookings-checkout-form input").attr("disabled","disabled");jQuery("#bookings-pay").html(result.html);jQuery("#book3-submit").hide();jQuery(".bookings-payment-gateways a").click(function(){that.pay(jQuery(this));return false})}else{if((result.status=="complete")&&(result.errors!=null)){jQuery("#bookings-section-notices").show();jQuery("#bookings-section-notices #bookings-errors").show();jQuery("#bookings-section-notices #bookings-errors").html(result.errors)}else{if(result.status=="complete"){jQuery("#bookings-section-notices").show();jQuery("#bookings-section-notices #bookings-notices").show();jQuery("#bookings-section-notices #bookings-notices").html(result.html);jQuery("#bookings-section-cart").hide();jQuery("#bookings-section-checkout").hide();jQuery("#book3-submit").hide();that.data=new Array();that.firstSlot=true;that.slots=new Array();jQuery.removeCookie("bookings")}else{jQuery("#bookings-checkout-form").html(result.html)}}}return;jQuery("#bookings-section-checkout").show("fold");if(jQuery(request).find("#bookings-errors").length>0){jQuery("#book3-submit").hide()}else{}}})};templatex.pay=function(e){var url=e.attr("href");url=url.replace("?zfaces=book1",aphpsAjaxURL+"pay");jQuery(".aphpsSpinner").show();new jQuery.ajax({url:url,type:"post",data:{module:"bookings",bookingssid:this.sid,bookingspid:this.pid},success:function(request){try{var result=eval("("+request+")")}catch(e){jQuery(".aphpsSpinner").hide();throw"Could not parse JSON"}jQuery("#bookings-pay").html(result.html);if(jQuery("#gtwpay-payment").find("#saas-redirect-location").length==1){var url=jQuery("#gtwpay-payment").find("#saas-redirect-location").html();url=url.replace(/&amp;/g,"&");window.location=url}}})};templatex.addToCart=function(){var a={};a.machid=this.machid;a.productid=this.productid;a.quantity=this.quantity;a.slots=this.slots;a.productname=this.productname;a.resourcename=this.resourcename;a.price=this.totPrice;if(this.quantity>1){this.hasQuantity=true}this.data[this.data.length]=a;jQuery.cookie("bookings",JSON.stringify(this.data),{expires:1});this.displayCart();this.remove()};templatex.displayCart=function(){var b=0;jQuery("#bookings-cart").show("fold");if(this.useCart==true){jQuery("#bookings-cart-buttons").delay(200).show("fold")}jQuery("#bookings-section1").hide("fold");jQuery("#bookings-section2").hide("fold");jQuery("#bookings-calendar").hide("fold");if(this.useCart==true){jQuery("#bookings-cart-icon").show("fold")}var h=jQuery("#bookings-cart .bookings-cart-line:first").clone();jQuery("#bookings-cart .bookings-cart-line").remove();for(var d=0;d<this.data.length;d++){e=h.clone();e.attr("id",d);e.find(".bookings-product-name").html(this.data[d].productname);e.find(".bookings-resource-name").html(this.data[d].resourcename);e.find(".bookings-quantity").html(this.data[d].quantity);e.find(".bookings-price").html(this.formatAmount(this.data[d].price));b+=this.data[d].price*this.data[d].quantity;var f=e.find(".bookings-time-slot:first").clone();e.find(".bookings-time-slot").remove();for(var a=0;a<this.data[d].slots.length;a++){var c=f.clone();c.html(this.data[d].slots[a].datelabel+"&nbsp;"+this.data[d].slots[a].timelabel);e.find(".bookings-time-slots").append(c)}jQuery("#bookings-cart #bookings-cart-total").before(e)}if(this.hasPricing()==false){jQuery(".bookings-cart-line .bookings-resource-name").css({width:"49%"});jQuery(".bookings-cart-line .bookings-price").hide();jQuery("#bookings-cart-total").hide()}jQuery("#bookings-cart-total").html(this.formatAmount(b));var g=this;jQuery("#bookings-cart .bookings-cart-line .bookings-delete img").click(function(){g.removeFromCart(jQuery(this))});if(this.useCart!=1){this.checkoutForm()}else{jQuery("#bookings-cart-checkout-button").show();jQuery("#bookings-cart-checkout-button").click(function(){g.checkoutForm()})}};templatex.removeFromCart=function(b){var a=b.closest(".bookings-cart-line");this.data.splice(a.attr("id"),1);jQuery.cookie("bookings",JSON.stringify(this.data),{expires:7});if(this.data.length==0){jQuery("#bookings-cart-icon").hide();jQuery("#bookings-cart-icon").click();this.remove();if(this.count1==1){this.parent.find("tr").click()}}else{this.displayCart()}};templatex.getPrice=function(index,dt,st,ed,et){var label=jQuery("#bookings-submit-times").val();jQuery("#bookings-submit-times").button("disable");jQuery("#bookings-submit-times").val(label);var that=this;new jQuery.ajax({url:aphpsAjaxURL+"price",type:"post",data:{module:"bookings",productid:this.productid,machid:this.machid,quantity:this.quantity,dt:dt,st:st,ed:ed,et:et,bookingssid:this.sid,bookingspid:this.pid,cart:this.data},success:function(request){try{var result=eval("("+request+")")}catch(e){throw"Could not parse JSON"}jQuery("#bookings-submit-times").button("enable");jQuery("#bookings-submit-times").val(label);that.slots[index].price=result.price;that.totPrice+=result.price*1;jQuery(".bookings-price").html(that.formatAmount(that.totPrice));for(var i=0;i<result.cartPrices.length;i++){that.data[i].price=result.cartPrices[i]}}})};templatex.formatAmount=function(c){var d=",";var b=".";c=c*1;c=c.toFixed(2);c.replace(".",b);c+="";x=c.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1"+d+"$2")}return this.currency+x1+x2};var bookx=jQuery.extend(true,{},templatex);bookx.cascadeSelect=function(c,f,e){this.parent=c;var b;if(e==1){b="option"}else{b="tr"}var a=f.find(b+":not(.static)");f.data("options",a);this.count1=c.find("tr").length;if((this.count1==1)&&(c.find("tr").attr("id")==0)){this.count1=0}var d=this;c.find("tr").click(function(){var g=jQuery(this).attr("id");d.count2=f.data("options").filter(".sub_"+g).length;if(d.count1==0){jQuery("#bookings-section-products").hide();jQuery("#bookings-section-resources").css({width:"99%"});jQuery("#bookings-section-resources").delay(400).show("fold")}else{if(d.count2==1){}else{jQuery("#bookings-section-products").animate({width:"49%"});jQuery("#bookings-section-resources").delay(400).show("fold")}}a.remove();jQuery(c).find("tr").removeClass("bookingsSelectedRow");jQuery(this).addClass("bookingsSelectedRow");f.append(f.data("options").filter(".sub_"+g)).change();jQuery(f).find("tr").removeClass("bookingsSelectedRow");d.productid=g;d.productname=jQuery(this).find(".bookings-product-name").html();if(d.count2==1){jQuery("#bookings-section-resources tr").click()}});a.not(".static, .sub_"+c.val()).remove();if((this.mode=="normal")&&(this.count1<=1)){c.find("tr").click()}};bookx.cascadeSelectResource=function(d,b){var c=jQuery(d);var a=c.attr("data-max");c.parent().find("tr").removeClass("bookingsSelectedRow");c.addClass("bookingsSelectedRow");this.machid=b;this.resourcename=c.find(".bookings-resource-name").html();this.allowMulti=c.attr("data-allowmulti");if(a>1){this.quantitySelector(a)}else{jQuery("#bookings-section-quantity").hide();if(this.count1>1){jQuery("#bookings-section-products").animate({width:"49%"});jQuery("#bookings-section-resources").animate({width:"49%"})}this.quantity=1;this.getCalendar()}};bookx.quantitySelector=function(a){if(this.count1==0){jQuery("#bookings-section-resources").css({width:"87%"})}else{if(this.count2==1){jQuery("#bookings-section-products").css({width:"87%"})}else{jQuery("#bookings-section-products").animate({width:"43%"});jQuery("#bookings-section-resources").animate({width:"43%"})}}jQuery("#bookings-section-quantity").delay(400).show("fold");var c=jQuery('<option value="0">&nbsp;</option>');jQuery("#bookings-section-quantity select").append(c);for(var b=1;b<=a;b++){var c=jQuery('<option value="'+b+'">'+b+"</option>");jQuery("#bookings-section-quantity select").append(c)}var d=this;jQuery("#bookings-section-quantity select").prop("disabled",false);jQuery("#bookings-section-quantity select").change(function(){d.selectQuantity()})};bookx.selectQuantity=function(){var a=jQuery("#bookings-section-quantity select").val();if(a>0){jQuery("#bookings-section-quantity select").prop("disabled",true);this.quantity=a;this.getCalendar()}};bookx.getCalendar=function(){jQuery(".aphpsSpinner").show();that=this;jQuery("#bookings tr:not(.bookingsSelectedRow)").hide("fold");jQuery("#bookings-section-resources .bookings-section-title").hide("fold");jQuery("#bookings-section-products .bookings-section-title").hide("fold");jQuery("#bookings-section-quantity .bookings-section-title").hide("fold");if(bookingsStandalone){bookingsAjax(url,null);return}new jQuery.ajax({url:aphpsAjaxURL+"calendar",type:"post",data:{module:"bookings",machid:this.machid,quantity:this.quantity,productid:this.productid,bookingssid:this.sid,bookingspid:this.pid},success:function(b){jQuery(".aphpsSpinner").hide();var a=jQuery("#bookings-edit");a.show("fold");a.click(function(){that.remove()});that.refreshCalendar(b)},error:function(a,c,b){jQuery(".aphpsSpinner").hide();alert("An error occurred!")}})};bookx.remove=function(){jQuery("#bookings-section-products").show();jQuery("#bookings-section-products .bookings-section-title").show("fold");jQuery("#bookings-section-resources").hide();jQuery("#bookings-section-quantity").hide();jQuery("#bookings-section-products").animate({width:"99%"});jQuery("#bookings-edit").hide();jQuery("#bookings-section-products tr").show();jQuery("#bookings-section-products tr").removeClass("bookingsSelectedRow");jQuery("#bookings-section-resources tr").show();jQuery("#bookings-section-resources .bookings-section-title").show();jQuery("#bookings-section-quantity .bookings-section-title").show();jQuery("#bookings-calendar").html("");jQuery("#bookings-section-resources").css({width:"49%"});jQuery("#bookings-section-selected-times").html("");jQuery("#bookings-section-times").hide();jQuery("#bookings-section-selected-times-submit").hide();jQuery("#bookings-section-quantity select").html("");this.firstSlot=true;this.slots=new Array();this.totPrice=0};bookx.changeResCalendar=function(e,g,j,l,c,h,f){var k=c.split("|");var i=k[0];var b=(i=="s")?"scheduleid":"machid";var c=k[1];var a=aphpsAjaxURL+"calendar&date="+e+"-"+g+"-"+j+"&viewB="+l+"&"+b+"="+c+"&bookingssid="+this.sid;this.view=l;jQuery(".aphpsSpinner").show();that=this;if(bookingsStandalone){bookingsAjax(a,null)}else{new jQuery.ajax({url:a,type:"post",data:{module:"bookings",quantity:this.quantity,bookingspid:this.pid},success:function(d){jQuery(".aphpsSpinner").hide();that.refreshCalendar(d)}})}};bookx.refreshCalendar=function(b){jQuery("#bookings-calendar").html(b);jQuery("#bookings-calendar").show("fold");var a=this;jQuery(".bookings-timeslots-time").click(function(){a.addTimeSlot(jQuery((this)));return false})};bookx.addTimeSlot=function(i){if(this.firstSlot){jQuery("#bookings-section-selected-times-submit").show("fold");this.firstSlot=false;jQuery(".bookings-timeslots-times .bookings-timeslots-time").css({cursor:"not-allowed"})}else{if(this.allowMulti!=1){return}}i.addClass("bookings-timeslots-selected");jQuery("#bookings-section-times").show("fold");var b=i.parent().parent().find(".bookings-timeslots-date").attr("data-sd");var a=i.attr("data-dt");var l=i.attr("data-st");var f=i.attr("data-ed");if(f==null){f=a}var k=i.attr("data-et");var h=this.slots.length;this.slots[h]={dt:a,st:l,et:k,ed:f,id:i.attr("id"),timelabel:i.html(),datelabel:b};this.getPrice(h,a,l,f,k);var j=jQuery("#bookings-section-selected-times");var d=j.offset();var c=i.offset();var g=this;i.clone().offset({top:c.top,left:c.left}).css({position:"absolute"}).appendTo(jQuery("body")).animate({top:d.top,left:d.left},500,function(){var o=i.clone();var e=jQuery("<img>").attr("src",aphpsBaseUrl+"app/sit/img/closed_16x16.png");var m=e.wrapAll("<div></div>").parent().html();o.html(b+"&nbsp;"+o.html()+m);o.appendTo(j);o.find("img").click(function(){g.removeTimeSlot(jQuery(this).parent())});jQuery("#bookings-section-selected-times div").sortElements(function(p,n){return jQuery(p).attr("id")>jQuery(n).attr("id")?1:-1});jQuery(this).remove()});return false};bookx.removeTimeSlot=function(b){var c=b.attr("id");for(var a=this.slots.length-1;a>=0;a--){if(this.slots[a].id===c){this.totPrice-=this.slots[a].price;this.slots.splice(a,1)}}jQuery(".bookings-timeslots-times").find("#"+c).removeClass("bookings-timeslots-selected");b.remove();if(jQuery("#bookings-section-selected-times div").length==0){jQuery(".bookings-timeslots-times .bookings-timeslots-time").css({cursor:"pointer"});jQuery("#bookings-section-times").hide("fold");jQuery("#bookings-section-selected-times-submit").hide("fold");this.firstSlot=true}};bookx.changeDate=function(b,a){this.changeResCalendar(b,1,a,this.view,"m|"+this.machid);return false};bookx.changeSelectedMonth=function(){var b=jQuery("#monthselect").val();var a=jQuery("#newyear").val();this.changeResCalendar(b,1,a,this.view,"m|"+this.machid)};var hotelx=jQuery.extend(true,{},templatex);hotelx.start=function(){this.scheduleid=jQuery("#bookings-section1 #scheduleid").val();var a=this;jQuery("#bookings-search").click(function(){a.availability()})};hotelx.availability=function(){var a=this;jQuery(".aphpsSpinner").show();new jQuery.ajax({url:aphpsAjaxURL+"availability",type:"post",data:{module:"bookings",machid:this.machid,fromdate:jQuery(".hotelx #fromdate").val(),fromtime:jQuery(".hotelx #fromtime").val(),todate:jQuery(".hotelx #todate").val(),totime:jQuery(".hotelx #totime").val(),scheduleid:this.scheduleid,bookingssid:this.sid,bookingspid:this.pid},success:function(b){jQuery(".aphpsSpinner").hide();jQuery("#bookings-section2 #bookings-availability").html(b);if(jQuery("#bookings-section2 #bookings-results").attr("data-hasresults")==1){jQuery("#bookings-section2 #bookings-results").show("fold")}jQuery("#bookings-section2 #bookings-results .bookings-quantity select").change(function(){a.changeQuantity(jQuery(this))});jQuery("#bookings-section2 #bookings-results #bookings-next").button();jQuery("#bookings-section2 #bookings-results #bookings-next").click(function(){a.addToCart()})},error:function(b,d,c){jQuery(".aphpsSpinner").hide();alert("An error occurred!")}})};hotelx.changeQuantity=function(b){var a=false;jQuery("#bookings-section2 #bookings-results .bookings-quantity select").each(function(){if(jQuery(this).val()>0){a=true}});if(a){jQuery("#bookings-section2 #bookings-results #bookings-next").show("fold");jQuery("#bookings-section2 #bookings-results #bookings-next").button("enable")}else{jQuery("#bookings-section2 #bookings-results #bookings-next").button("disable")}};hotelx.addToCart=function(){var d=jQuery("#bookings-section2 #bookings-results #dt").val();var a=jQuery("#bookings-section2 #bookings-results #ed").val();var b=jQuery("#bookings-section2 #bookings-results #st").val();var e=jQuery("#bookings-section2 #bookings-results #et").val();var c=this;jQuery("#bookings-section2 #bookings-results .bookings-quantity select").each(function(){var i=jQuery(this);var h=i.val();if(h>0){var f=jQuery(this).closest(".bookings-line");var g={};g.machid="*";g.productid=f.attr("data-productid");g.quantity=h;g.slots=new Array();g.slots[0]={dt:d,ed:a,st:b,et:e,datelabel:jQuery("#bookings-results #bookings-datelabel").html(),timelabel:""};g.productname=f.find(".productname").html();g.resourcename="&nbsp;";g.price=f.find(".productprice").attr("data-price");c.hasQuantity=true;c.data[c.data.length]=g}});jQuery.cookie("bookings",JSON.stringify(this.data),{expires:1});jQuery("#bookings-results").hide("fold");this.displayCart();this.remove()};(function(a){a.fn.serializeObject=function(){var b=this,d={},c={},e={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};this.build=function(h,f,g){h[f]=g;return h};this.push_counter=function(f){if(c[f]===undefined){c[f]=0}return c[f]++};a.each(a(this).serializeArray(),function(){if(!e.validate.test(this.name)){return}var f,g=this.name.match(e.key),i=this.value,h=this.name;while((f=g.pop())!==undefined){h=h.replace(new RegExp("\\["+f+"\\]$"),"");if(f.match(e.push)){i=b.build([],b.push_counter(h),i)}else{if(f.match(e.fixed)){i=b.build([],f,i)}else{if(f.match(e.named)){i=b.build({},f,i)}}}}d=a.extend(true,d,i)});return d}})(jQuery);jQuery.fn.sortElements=(function(){var a=[].sort;return function(c,d){d=d||function(){return this};var b=this.map(function(){var f=d.call(this),e=f.parentNode,g=e.insertBefore(document.createTextNode(""),f.nextSibling);return function(){if(e===this){throw new Error("You can't sort elements if any one is a descendant of another.")}e.insertBefore(this,g);e.removeChild(g)}});return a.call(this,c).each(function(e){b[e].call(d.call(this))})}})();/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){a(require("jquery"))}else{a(jQuery)}}}(function(f){var a=/\+/g;function d(i){return b.raw?i:encodeURIComponent(i)}function g(i){return b.raw?i:decodeURIComponent(i)}function h(i){return d(b.json?JSON.stringify(i):String(i))}function c(i){if(i.indexOf('"')===0){i=i.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{i=decodeURIComponent(i.replace(a," "));return b.json?JSON.parse(i):i}catch(j){}}function e(j,i){var k=b.raw?j:c(j);return f.isFunction(i)?i(k):k}var b=f.cookie=function(q,p,v){if(p!==undefined&&!f.isFunction(p)){v=f.extend({},b.defaults,v);if(typeof v.expires==="number"){var r=v.expires,u=v.expires=new Date();u.setTime(+u+r*86400000)}return(document.cookie=[d(q),"=",h(p),v.expires?"; expires="+v.expires.toUTCString():"",v.path?"; path="+v.path:"",v.domain?"; domain="+v.domain:"",v.secure?"; secure":""].join(""))}var w=q?undefined:{};var s=document.cookie?document.cookie.split("; "):[];for(var o=0,m=s.length;o<m;o++){var n=s[o].split("=");var j=g(n.shift());var k=n.join("=");if(q&&q===j){w=e(k,p);break}if(!q&&(k=e(k))!==undefined){w[j]=k}}return w};b.defaults={};f.removeCookie=function(j,i){if(f.cookie(j)===undefined){return false}f.cookie(j,"",f.extend({},i,{expires:-1}));return !f.cookie(j)}}));if(typeof bookingsAjaxUrl==="undefined"){bookingsAjaxUrl="index.php?"}if(typeof bookingsPageurl==="undefined"){bookingsPageurl="index.php?"}var bookings={};var bookingsDialog;var bookingsDialog2;var bookings=new Object();var bookingsStandalone=0;function bookingsFindVarInUrl(b,a){var d=b.split("&");for(var c in d){var g=d[c].split("=");if(g[0]==a){return g[1]}}}function bookingsRewriteReservationLinks(){jQuery("#bookings #reservations").find('[data-action="view"]').closest("tr").addClass("bookingsApprovedReservation");jQuery("#bookings #reservations").find('[data-action="approve"]').closest("tr").removeClass("bookingsApprovedReservation");jQuery("#bookings #reservations").find('[data-action="approve"]').closest("tr").addClass("bookingsUnApprovedReservation");jQuery("#bookings #reservations").find('[data-action="edit"],[data-action="view"],[data-action="delete"],[data-action="approve"]').bind("click",this,function(b){var d=jQuery(this);var a=d.attr("href");var c=d.attr("data-action").substr(0,1);if(c=="e"){c="m"}var g=bookingsFindVarInUrl(a,"id");bookingsReserve(c,"","",g);return false})}function bookingsToggleReserve(b){if(b=="blackout"){var a=jQuery("#bookingsSelectBlackout");a.addClass("bookingsButtonPushed");jQuery("#bookingsSelectReserve").removeClass("bookingsButtonPushed");jQuery("#bookingsReservePanel").hide()}else{if(b=="reserve"){var a=jQuery("#bookingsSelectReserve");a.addClass("bookingsButtonPushed");jQuery("#bookingsSelectBlackout").removeClass("bookingsButtonPushed");jQuery("#bookingsReservePanel").show()}}}function checkForm(a){var b="Please fix these errors:\n";var c=false;if(a.fname.value==""){b+="-First name is required\n";c=true}if(a.lname.value==""){b+="-Last name is required\n";c=true}if(a.phone.value==""){b+="-Phone number is required\n";c=true}if(a.institution.value==""){b+="-Institution is required\n";c=true}if((a.email.value=="")||(a.email.value.indexOf("@")==-1)){b+="-Valid email is required\n";c=true}if(c){window.alert(b);return false}return true}function verifyEdit(){var a="Please fix these errors:\n";var b=false;if((document.register.email.value!="")&&(document.register.email.value.indexOf("@")==-1)){a+="-Valid email is required\n";b=true}if((document.register.password.value!="")&&(document.register.password.value.length<6)){a+="-Min 6 character password is required\n";b=true}if((document.register.password.value!="")&&(document.register.password.value!=document.register.password2.value)){a+=("-Passwords to not match\n");b=true}if(b){window.alert(a);return false}return true}function bookingsReserve(type,machid,start_date,resid,scheduleid,is_blackout,read_only,pending,starttime,endtime){if((bookingsDialog instanceof jQuery)){return}if(is_blackout==null){is_blackout=0}w=(type=="r"||type=="m")?650:520;if(machid==null){machid=""}if(start_date==null){start_date=""}if(resid==null){resid=""}if(scheduleid==null){scheduleid=""}if(read_only==null){read_only=""}if(pending==null){pending=""}if(starttime==null){starttime=""}if(endtime==null){endtime=""}if((bookingsDialog2 instanceof jQuery)&&bookingsDialog2.dialog("isOpen")){bookingsDialog2.dialog("close")}nurl=bookingsAjaxUrl+"ajax=2&zfaces=reserve&type="+type+"&machid="+machid+"&start_date="+start_date+"&resid="+resid+"&scheduleid="+scheduleid+"&is_blackout="+is_blackout+"&read_only="+read_only+"&pending="+pending+"&starttime="+starttime+"&endtime="+endtime;jQuery(".aphpsSpinner").show();bookingsDialog=jQuery("<div></div>");new jQuery.ajax({url:nurl,type:"get",success:function(request){jQuery(".aphpsSpinner").hide();var jsRequest=eval("("+request+")");bookingsDialog.html(jsRequest.body);bookingsDialog.dialog({height:"auto",width:w,modal:true,draggable:false,dialogClass:"bookings aphps",close:function(ev,ui){bookingsDialog.remove();bookingsDialog=null}})}});void (0)}function bookingsReserveWithoutPopup(d,c,b,g,j){if(d=="a"){text="approve"}else{if(d=="d"){text="cancel"}else{if(d=="c"){text="cancel"}}}var a=confirm("Are you sure you want to "+text+" this meeting?");if(a){if(d=="a"){fn="approve"}else{if((d=="d")&&(j==1)){fn="delete_req"}else{if(d=="d"){fn="delete"}else{if((d=="c")&&(j==1)){fn="cancel_req"}else{if(d=="c"){fn="cancel"}}}}}nurl=bookingsAjaxUrl+"ajax=2&zfaces=reserve";jQuery(".aphpsSpinner").show();new jQuery.ajax({url:nurl,type:"post",data:{btnSubmit:1,fn:fn,resid:g},success:function(k){location.reload()},error:function(k,m,l){jQuery(".aphpsSpinner").hide();alert("An error occurred!")}})}void (0)}function bookingsCloseDialog(){bookingsDialog.dialog("close")}function checkDate(){var b=document.getElementById("jumpWeek");var g=document.getElementById("jumpMonth").value;var a=document.getElementById("jumpDay").value;var d=document.getElementById("jumpYear").value;var j=new Array();if(d%4==0){j=[31,29,31,30,31,30,31,31,30,31,30,31]}else{j=[31,28,31,30,31,30,31,31,30,31,30,31]}if((g>12)||(a>j[g-1])){alert("Please enter valid date value");return false}for(var c=0;c<b.childNodes.length-1;c++){if(b.childNodes[c].type=="text"||b.childNodes[c].type=="textbox"){if((b.childNodes[c].value<=0)||(b.childNodes[c].value.match(/\D+/)!=null)){alert("Please enter valid date value");b.childNodes[c].focus();return false}}}changeScheduler(g,a,d,0,"")}function verifyTimes(a){if(a.del&&a.del.checked){return confirm("Delete this reservation?")}if(parseFloat(a.starttime.value)<parseFloat(a.endtime.value)){return true}else{window.alert("End time must be later than start time\nCurrent start time: "+a.starttime.value+" Current end time: "+a.endtime.value);return false}}function checkAdminForm(){var a=false;var b=jQuery("#manageSchedule input[type=checkbox]");b.each(function(){if(this.checked){a=true}});if(a){if(confirm("This will delete all reservations and permission information for the checked items!\nContinue?")){jQuery(".aphpsSpinner").show();return true}else{return false}}else{alert("No boxes have been checked!");return false}}function checkBoxes(){var b=document.train;for(var a=0;a<b.elements.length;a++){if(b.elements[a].type=="checkbox"){b.elements[a].checked=true}}void (0)}function viewUser(b){var a=jQuery(b).attr("href");bookingsWindowOpen(a,"UserInfo","width=400,height=400,scrollbars,resizable=no,status=no");return false}function checkAddResource(a){var b="";minres=(parseInt(a.minH.value)*60)+parseInt(a.minM.value);maxRes=(parseInt(a.maxH.value)*60)+parseInt(a.maxM.value);if(a.name.value==""){b+="-Resource name is required.\n"}if(parseInt(minres)>parseInt(maxRes)){b+="-Minimum reservaion time must be less than or equal to maximum"}if(b!=""){alert("You have the following errors:\n\n"+b);return false}jQuery(".aphpsSpinner").show();return true}function checkAddSchedule(){var a=document.addSchedule;var b="";if(a.scheduletitle.value==""){b+="-Schedule title is required.\n"}if(parseInt(a.daystart.value)>parseInt(a.dayend.value)){b+="-Invalid start/end times.\n"}if(a.viewdays.value==""||parseInt(a.viewdays.value)<=0){b+="Invalid view days.\n"}if(a.adminemail.value==""){b+="Admin email is required.\n"}if(b!=""){alert("You have the following errors:\n\n"+b);return false}jQuery(".aphpsSpinner").show();return true}function checkAllBoxes(b){var c=document.forms[0];for(var a=0;a<c.elements.length;a++){if(c.elements[a].type=="checkbox"&&c.elements[a].name!="notify_user"){c.elements[a].checked=b.checked}}void (0)}function bookingsSubmitReservationForm(f){var view=jQuery(document).getUrlParam("view");if(check_reservation_form(f)){jQuery(".aphpsSpinner").show();var form=jQuery("form#reserve");var url=bookingsAjaxUrl;if(form.attr("action").split("?")[1]!=null){url+=form.attr("action").split("?")[1]}else{url+="zfaces=reserve"}if(jQuery("#bookingsReservePanel").length>0){if(jQuery("#bookingsSelectBlackout").hasClass("bookingsButtonPushed")){var blackout=1}else{var blackout=0}}else{var blackout=1}jQuery.post(url,form.serialize()+"&ajax=2&btnSubmit=1&is_blackout="+blackout,function(response){var js=eval("("+response+")");if(js.errors.length==0){var background=jQuery("#bookings");if(view==5){var machid=jQuery(f).find("#machid").val();var oriStart=jQuery(f).find("#hdn_start_date_ori").val()*1+jQuery(f).find("#hdn_start_ori").val()*60;var oriEnd=jQuery(f).find("#hdn_end_date_ori").val()*1+jQuery(f).find("#hdn_end_ori").val()*60;var oriDays=(oriEnd-oriStart)/86400;background.find("#slot-"+machid+"-"+oriStart).attr("colspan",1);background.find("#slot-"+machid+"-"+oriStart).find("div").css("width","20px");background.find("#slot-"+machid+"-"+oriStart).removeClass("blackout");background.find("#slot-"+machid+"-"+oriStart).addClass("available");for(t=oriStart+86400;t<oriEnd;t+=86400){background.find("#slot-"+machid+"-"+oriStart).after('<td id="slot-'+machid+"-"+t+'" class="MyCalCellColor available"><div style="width:20px">&nbsp;</div></td>')}var dt=new Date(jQuery(f).find("#hdn_start_date").val());var ed=new Date(jQuery(f).find("#hdn_end_date").val());var start=dt.getTime()/1000+jQuery(f).find("#starttime").val()*60-dt.getTimezoneOffset()*60;var end=ed.getTime()/1000+jQuery(f).find("#endtime").val()*60-ed.getTimezoneOffset()*60;var days=(end-start)/86400;background.find("#slot-"+machid+"-"+start).removeClass("available");background.find("#slot-"+machid+"-"+start).addClass("pending");background.find("#slot-"+machid+"-"+start).attr("colspan",days);background.find("#slot-"+machid+"-"+start).find("div").css("width",(20*days)+"px");if(jQuery(f).find("#fn")=="create"){background.find("#slot-"+machid+"-"+start).attr("onclick","")}else{background.find("#slot-"+machid+"-"+start).attr("onmouseover","");background.find("#slot-"+machid+"-"+start).attr("onmousemove","");background.find("#slot-"+machid+"-"+start).attr("onmouseout","")}for(t=start+86400;t<end;t+=86400){background.find("#slot-"+machid+"-"+t).remove()}bookingsDialog.html(js.body).delay(1500).queue(function(nxt){bookingsDialog.dialog("close");nxt()});jQuery(".aphpsSpinner").hide()}else{bookingsDialog.html(js.body);location.reload()}}else{bookingsDialog.html(js.body).delay(1500).queue(function(nxt){bookingsDialog.dialog("close");nxt()});jQuery(".aphpsSpinner").hide()}})}return false}function check_reservation_form(d){var g=false;var b=false;var c=false;var j="";if((typeof d.interval!="undefined")&&d.interval.value!="none"){c=true;if(d.interval.value=="week"||d.interval.value=="month_day"){for(var a=0;a<d.elements["repeat_day[]"].length;a++){if(d.elements["repeat_day[]"][a].checked==true){b=true}}}else{b=true}if(d.repeat_until.value==""){j+="- Please choose an ending date\n";g=false}}else{g=true;b=true}if(b==false){g=false;j+="- Please select days to repeat on"}if(j!=""){alert(j)}return(j=="")}function check_for_delete(a){if(a.del&&a.del.checked==true){return confirm("Delete this reservation?")}}function toggle_fields(a){document.forms[0].elements["table,"+a.value+"[]"].disabled=(a.checked==true)?false:"disabled"}function refreshDialog2(b){var a=jQuery(b).attr("href");bookingsWindowOpen(a);return false}function search_user_lname(letter){if(letter!=null){jQuery("#firstName").val("");jQuery("#lastName").val(letter)}jQuery(".aphpsSpinner").show();var form=jQuery("form#name_search");jQuery.get(form.attr("action"),form.serialize()+"&ajax=2&searchUsersBtn=1",function(response){jQuery(".aphpsSpinner").hide();var js=eval("("+response+")");bookingsDialog2.html(js.body)})}function bookings_create_user(){jQuery(".aphpsSpinner").show();var form=jQuery("form#register");jQuery.post(form.attr("action"),form.serialize()+"&ajax=2&register=1",function(response){jQuery(".aphpsSpinner").hide();var js=eval("("+response+")");bookingsDialog2.html(js.body)})}function isIE(){return document.all}function changeDate(b,a){jQuery("#newmonth").attr("value",b);jQuery("#newyear").attr("value",a);if(bookingsStandalone){bookingsSubmit(jQuery("#changeMonth"))}else{jQuery("#changeMonth").submit()}}function changeSelectedMonth(a){var b=jQuery("#monthselect").val();jQuery("#newmonth").attr("value",b);if(bookingsStandalone){bookingsSubmit(jQuery("#changeMonth"))}else{jQuery("#changeMonth").submit()}}function changeScheduler(j,o,r,v,n,u){var l;newDate=j+"-"+o+"-"+r;keys=new Array();vals=new Array();var b=(v)?window.opener.document.location.search.substring(0):document.location.search.substring(0);b=b.replace("?","");var g=b.split("&");var a=(v)?window.opener.document.URL.split("?")[0]:document.URL.split("?")[0];var c="";for(var k=0;k<g.length;k++){var q=g[k].indexOf("=");if(q>=0){var p=g[k].substring(0,q);var s=g[k].substring(q+1);keys[keys.length]=p;vals[vals.length]=s}}for(k=0;k<keys.length;k++){if(keys[k]=="scheduleid"){c=vals[k]}if(keys[k]=="zfaces"){l=vals[k]}}if(n!=""){c=n}if(l==null){l="schedule"}if(v){window.opener.location=a+"?date="+newDate+"&scheduleid="+c+"&page=bookings&zfaces="+l}else{document.location.href=bookingsPageurl+"zfaces="+l+"&date="+newDate+"&scheduleid="+c+(u!=null?"&machid="+u:"")}}function isIE7(){return(document.all&&(typeof document.body.style.maxHeight!="undefined"))}function ssum(a,b){showsummary("summary",a,b)}function hsum(){hideSummary("summary")}function msum(a){moveSummary("summary",a)}function showsummary(d,k,n){var g=jQuery("#"+d).parent().offset();var j=jQuery(window).width();var a=jQuery(window).height();var m=0;var l=k.pageY-g.top+m+"px";var c=0;var b=k.pageX-g.left+15+c+"px";jQuery("#"+d).html(n);jQuery("#"+d).css("z-index",1000);jQuery("#"+d).css({visibility:"visible",relative:"absolute",top:l,left:b})}function getAbsolutePosition(b){var c={x:b.offsetLeft,y:b.offsetTop};if(b.offsetParent){var a=getAbsolutePosition(b.offsetParent);c.x+=a.x;c.y+=a.y}return c}function moveSummary(a,b){return;myLayer=document.getElementById(a);w=parseInt(myLayer.style.width);h=parseInt(myLayer.style.height);if(b!=""){if(isIE()){x=b.clientX;y=b.clientY;browserX=document.body.offsetWidth-25;if(isIE7()){x+=document.documentElement.scrollLeft-document.body.clientLeft;y+=document.documentElement.scrollTop-document.body.clientTop}else{x+=document.body.scrollLeft;y+=document.body.scrollTop}}if(!isIE()){x=b.pageX;y=b.pageY;browserX=window.innerWidth-30}}x1=x+20;y1=y+20;if(x1+w>browserX){x1=browserX-w}myLayer.style.left=parseInt(x1)+"px";myLayer.style.top=parseInt(y1)+"px"}function hideSummary(a){myLayer=document.getElementById(a);myLayer.style.visibility="hidden"}function showHideDays(a){e=document.getElementById("days");if(a.options[2].selected==true||a.options[4].selected==true){e.style.visibility="visible";e.style.display=isIE()?"inline":"table"}else{e.style.visibility="hidden";e.style.display="none"}e=document.getElementById("week_num");if(a.options[4].selected==true){e.style.visibility="visible";e.style.display=isIE()?"inline":"table"}else{e.style.visibility="hidden";e.style.display="none"}}function selectRecurDate(a,c,g,b){f=window.opener.document.forms[0];f._repeat_until.value=a+"/"+c+"/"+g;f.repeat_until.value=f._repeat_until.value;window.close()}function setSchedule(a){f=document.getElementById("setDefaultSchedule");f.scheduleid.value=a;f.submit()}function changeSchedule(c){var a=document.URL.split("?")[0];var b=document.URL.split("?")[1];if(b.indexOf("blackout")!=-1){document.location.href=a+"?page=bookings&zfaces=blackouts&scheduleid="+c.options[c.selectedIndex].value}else{if(b.indexOf("stats")!=-1){document.location.href=a+"?page=bookings&zfaces=stats&scheduleid="+c.options[c.selectedIndex].value}else{document.location.href=a+"?page=bookings&zfaces=schedule&scheduleid="+c.options[c.selectedIndex].value}}}function showHideCpanelTable(b){var a=new Date();var c=a.getTime()+2592000000;a.setTime(c);var d="";if(document.getElementById(b).style.display=="none"){document.getElementById(b).style.display="block";d="show"}else{document.getElementById(b).style.display="none";d="hide"}document.cookie=b+"="+d+";expires="+a.toGMTString()}function changeLanguage(b){var a=new Date();var c=a.getTime()+2592000000;a.setTime(c);document.cookie="lang="+b.options[b.selectedIndex].value+";expires="+a.toGMTString()+";path=/";document.location.href=document.URL}function clickTab(a,b){jQuery("#main-tab-panel > div").hide();jQuery("#main-tab-panel > div#"+b).show()}function checkCalendarDates(){var a=document.getElementById("repeat_table");if(a==null){return}if(document.getElementById("hdn_start_date").value!=document.getElementById("hdn_end_date").value){a.style.display="none";a.style.visibility="hidden"}else{a.style.display=isIE()?"inline":"table";a.style.visibility="visible"}}function showHideMinMax(a){document.getElementById("minH").disabled=document.getElementById("minM").disabled=document.getElementById("maxH").disabled=document.getElementById("maxM").disabled=a.checked;if(!a.checked){jQuery("#minD").prop("disabled",true);jQuery("#minD").closest("tr").hide();jQuery("#minH").closest("tr").show();jQuery("#minM").closest("tr").show();jQuery("#maxH").closest("tr").show();jQuery("#maxM").closest("tr").show()}else{jQuery("#minD").closest("tr").show();jQuery("#minD").prop("disabled",false);jQuery("#minH").closest("tr").hide();jQuery("#minM").closest("tr").hide();jQuery("#maxH").closest("tr").hide();jQuery("#maxM").closest("tr").hide()}}function moveSelectItems(b,a){from_select=jQuery("#"+b).find("option");to_select=jQuery("#"+a);for(i=0;i<from_select.length;i++){option=jQuery(from_select[i]);if(option.attr("selected")=="selected"){newOption=jQuery("<option></option>");newOption.attr("value",option.attr("value"));newOption.attr("selected",option.attr("selected"));newOption.html(option.html());to_select.append(newOption);option.remove()}}}function selectAllOptions(c){var d=c.form;var b;for(b=0;b<d.elements.length;b++){if(d.elements[b].type=="select-multiple"&&d.elements[b].multiple==true){selectbox=d.elements[b];for(var a=0;a<selectbox.options.length;a++){selectbox.options[a].selected=true}}}}function changeMyCal(a,g,j,b){var c=document.URL.split("?")[0];document.location.href=c+"?date="+a+"-"+g+"-"+j+"&viewB="+b}function changeResCalendar(m,d,y,view,id,page,action){var url=document.URL.split("?")[0];var type_id=id.split("|");var type=type_id[0];var p=(type=="s")?"scheduleid":"machid";var id=type_id[1];if(page==null){page="rescalendar"}if(bookings.clientVersion<="3.0.2"){var nurl=bookingsPageurl+"ajax=2&spinner=1&zfaces="+page+"&date="+m+"-"+d+"-"+y+"&viewB="+view+"&"+p+"="+id}else{var nurl=bookingsAjaxUrl+"ajax=2&spinner=1&zfaces="+page+"&date="+m+"-"+d+"-"+y+"&viewB="+view+"&"+p+"="+id+"&bookingssid="+bookings.sid()}if(action!=null){nurl+="&action="+action}var slots=new Array();var select=jQuery(".multislot");for(i=0;i<select.length;i++){slot=jQuery(select[i]);if(slot.prop("checked")){slots.push(slot.attr("id"))}}jQuery(".aphpsSpinner").show();if(bookingsStandalone){bookingsAjax(nurl,null)}else{new jQuery.ajax({url:nurl,type:"get",success:function(request){jQuery(".aphpsSpinner").hide();var jsRequest=eval("("+request+")");jQuery("#bookings").html(jsRequest.body);for(i=0;i<slots.length;i++){jQuery("#"+slots[i]).prop("checked",true)}}})}}function bookingsChangeResCalendarMonth(e,machid){var i;var y=jQuery(e).find(":selected").attr("data-year");var m=jQuery(e).find(":selected").attr("data-month");var d=1;var page="book2";var nurl=bookingsAjaxUrl+"ajax=2&spinner=1&zfaces="+page+"&date="+m+"-"+d+"-"+y+"&viewB=1&machid="+machid+"&bookingssid="+bookings.sid();var slots=new Array();var select=jQuery(".multislot");for(i=0;i<select.length;i++){slot=jQuery(select[i]);if(slot.prop("checked")){slots.push(slot.attr("id"))}}jQuery(".aphpsSpinner").show();if(bookingsStandalone){bookingsAjax(nurl,null)}else{new jQuery.ajax({url:nurl,type:"get",success:function(request){jQuery(".aphpsSpinner").hide();var jsRequest=eval("("+request+")");jQuery("#bookings").html(jsRequest.body);for(i=0;i<slots.length;i++){jQuery("#"+slots[i]).prop("checked",true)}}})}}bookings.sid=function(){if(jQuery("#bookingssid").length>0){return jQuery("#bookingssid").val()}else{return 1}};bookings.refreshHotel2=function(scheduleId){var productId=jQuery("#productid").val();if(bookings.clientVersion<="3.0.2"){var nurl=bookingsPageurl+"ajax=2&spinner=1&zfaces=book2&productid="+productId+"&scheduleid"+scheduleId}else{var nurl=bookingsAjaxUrl+"ajax=2&spinner=1&zfaces=book2&productid="+productId+"&scheduleid"+scheduleId+"&bookingssid="+bookings.sid()}jQuery(".aphpsSpinner").show();if(bookingsStandalone){bookingsAjax(nurl,null)}else{new jQuery.ajax({url:nurl,type:"get",success:function(request){jQuery(".aphpsSpinner").hide();var jsRequest=eval("("+request+")");jQuery("#bookings").html(jsRequest.body)}})}};bookings.Search=function(){jQuery(".aphpsSpinner").show()};function selectUserForReservation(d,g,b,c,a){bookingsDialog2.dialog("close");jQuery("#memberid").val(d);jQuery("#name").html(g+" "+b);jQuery("#phone").html(a);jQuery("#email").html(c)}function adminRowClick(c,a,b){var d=document.getElementById(a);d.className=(c.checked)?"adminRowSelected":"cellColor"+(b%2)}function showHide(a){if(document.getElementById(a).style.display=="none"){document.getElementById(a).style.display="block"}else{document.getElementById(a).style.display="none"}}function submitJoinForm(c){var a=(c!=0);var b=document.getElementById("join_form");b.h_join_fname.value=(!a)?document.getElementById("join_fname").value:"";b.h_join_lname.value=(!a)?document.getElementById("join_lname").value:"";b.h_join_email.value=(!a)?document.getElementById("join_email").value:"";b.h_join_userid.value=(a)?document.getElementById("join_userid").value:"";b.h_join_resid.value=document.getElementById("resid").value;b.submit()}function validateReservationWindow(){document.getElementById("check").style.display="inline";var a=document.getElementById("reserve");a.target="check";a.submit()}function createXMLDoc(){var a=null;if(document.implementation&&document.implementation.createDocument){a=document.implementation.createDocument("","",null)}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM")}}return a}function getOption(a){if(isIE()){return new Option(a.text,a.value)}else{return a}}function showHere(b,d){var a=jQuery("#"+d);a.show();var c=jQuery("#export_menu_button").offset();a.offset(c)}function getOffset(c){var b=0;var a=0;if(c.offsetParent){while(c.offsetParent){b+=c.offsetLeft;a+=c.offsetTop;c=c.offsetParent}}else{if(c.x){b+=c.x;a+=c.y}}return new Array(b,a)}function switchStyle(b,a){b.className=a}function openExport(c,g,d,b){var a="type="+c;if(g.length>0){a+="&resid="+g}else{if(d.length>0){a+="&start_date="+d}if(b.length>0){a+="&end_date="+b}}window.open("admin.php?page=bookings&ajax=2&zfaces=ical&"+a)}function exportSearch(){var b=document.getElementById("type");var c=b[b.selectedIndex].value;var d=document.getElementById("nostart").checked?"":document.getElementById("hdn_start_date").value;var a=document.getElementById("noend").checked?"":document.getElementById("hdn_end_date").value;openExport(c,"",d,a)}function blurDiv(a,b){document.getElementById(b).className=a.checked?"blur_textbox":"textbox"}function updateEnd(c){var b=document.getElementById("endtime");var a=c.selectedIndex;b.selectedIndex=(b.options.length-1>a)?a+1:a}function cascadeSelect(c,g,d){var b;if(d==1){b="option"}else{b="tr"}var a=g.find(b+":not(.static)");g.data("options",a);c.change(function(){if(d==4){jQuery(".bookings-pr-notes").hide();jQuery("#bookings-pr-notes-"+this.value).show()}a.remove();g.append(g.data("options").filter(".sub_"+this.value)).change()});a.not(".static, .sub_"+c.val()).remove()}function bookingsCascadeSelectProduct(a){jQuery("#productid").val(a);return false}function bookingsCascadeSelectResource(b,a){jQuery("#machid").val(a);var c=jQuery(b).parent().parent().find(".bookings-qty").val();jQuery("#quantity").val(c);return true}function cancelReservation(c,d){if(confirm(c+"?")==true){var b=document.URL.split("?")[0]+"?zfaces=ctrlpnl&action=cancel&ajax=3&resid="+d;var a=jQuery(document).getUrlParam("page_id");if(a!=null){b+="&page_id="+a}new jQuery.ajax({url:b,type:"get",success:function(g){location.reload(true)}})}return void (0)}function bookingsWindowOpen(nurl,dest,params){jQuery(".aphpsSpinner").show();new jQuery.ajax({url:nurl,type:"get",success:function(request){jQuery(".aphpsSpinner").hide();var jsRequest=eval("("+request+")");if(!(bookingsDialog2 instanceof jQuery)){bookingsDialog2=jQuery('<div id="bookingsdialog2"></div>')}else{bookingsDialog2.dialog("open")}bookingsDialog2.html(jsRequest.body);bookingsDialog2.dialog({height:"auto",width:"500px",modal:true,draggable:false,dialogClass:"bookings aphps"})}})}function bookingsWindowClose(){if((bookingsDialog2 instanceof jQuery)&&bookingsDialog2.dialog("isOpen")){bookingsDialog2.dialog("close")}}function bookingsAdditionalInfo(e,machid,dt,st,et,title,used){var w=600;var h=440;bookings.id=jQuery(e).attr("id");if((bookingsDialog2 instanceof jQuery)&&bookingsDialog2.dialog("isOpen")){bookingsDialog2.dialog("close")}if((bookingsDialog instanceof jQuery)&&bookingsDialog.dialog("isOpen")){bookingsDialog.dialog("close")}var nurl=bookingsAjaxUrl+"ajax=2&zfaces=reservation&machid="+machid+"&start_date="+dt+"&starttime="+st+"&endtime="+et+"&used="+used;jQuery(".aphpsSpinner").show();new jQuery.ajax({url:nurl,type:"get",success:function(request){jQuery(".aphpsSpinner").hide();var jsRequest=eval("("+request+")");bookingsDialog=jQuery('<div title="'+title+'"></div>');bookingsDialog.html(jsRequest.body);bookingsDialog.dialog({height:"auto",width:w,modal:true,draggable:false,dialogClass:"bookings aphps"})}});return false;void (0)}function bookingsAdditionalInfoSave(){var b=jQuery("#reserve").serialize();var a=bookingsDialog.html();if((bookingsDialog instanceof jQuery)&&bookingsDialog.dialog("isOpen")){bookingsDialog.dialog("close")}var c=jQuery("#temp_bookingsAdditionalInfo");if(c.length>0){c.remove()}c=jQuery(document.createElement("div"));c.attr("id","temp_bookingsAdditionalInfo");c.html(a);action=jQuery(".bookings-step2").attr("action");jQuery(".bookings-step2").attr("action",action+"&"+b);jQuery(".bookings-step2").submit();return true}function bookingsCheckSlots(j,b,c){var d=false;var g=0;var a=jQuery(".multislot");for(i=0;i<a.length;i++){slot=jQuery(a[i]);if(slot.prop("checked")){d=true;g++}}if(!d){alert(j)}if(d&&b>0&&g>b){alert(c);return false}return d}bookings.status=false;bookings.fullDayMonthly={status:false};bookings.FullDayMonthlySelectRange=function(g,k,n,p,a,l,c){var j;var b=0;if(jQuery("#bookings #minres").length>0){b=jQuery("#bookings #minres").val()*60}jQuery("#bookings #minalert").slideUp();if(!bookings.fullDayMonthly.status){if(bookings.fullDayMonthly.endId>0){for(j=bookings.fullDayMonthly.startId;j<=bookings.fullDayMonthly.endId;j=j+86400){jQuery("#"+j).removeClass("selectBoxStyle")}}jQuery("#"+c).addClass("selectBoxStyle");bookings.fullDayMonthly.startId=c;bookings.fullDayMonthly.start={d:k,m:g,y:n};bookings.fullDayMonthly.endId=0;jQuery("#bookingsCalendarNext").find("#dt").val(c);jQuery("#book2-next").hide()}else{for(j=bookings.fullDayMonthly.startId+1;j<=c;j=j+86400){if(jQuery("#"+j).hasClass("bookedDayBoxStyle")){var o=jQuery("#bookingsHelpRangeBooked").html();alert(o);bookings.fullDayMonthly.status=false;return}}bookings.fullDayMonthly.endId=c;bookings.fullDayMonthly.end={d:k,m:g,y:n};for(j=bookings.fullDayMonthly.startId;j<=bookings.fullDayMonthly.endId;j=j+86400){jQuery("#"+j).addClass("selectBoxStyle")}jQuery("#bookingsCalendarNext").find("#ed").val(c);if(bookings.fullDayMonthly.endId-bookings.fullDayMonthly.startId+86400>=b){jQuery("#book2-next").show()}else{jQuery("#bookings #minalert").slideDown()}}bookings.fullDayMonthly.status=!bookings.fullDayMonthly.status};function checkAvailability(){nurl=bookingsAjaxUrl+"ajax=2&zfaces=check";data=jQuery("#reserve").serialize();jQuery(".aphpsSpinner").show();new jQuery.ajax({url:nurl,type:"post",data:data,success:function(request){jQuery(".aphpsSpinner").hide();var jsRequest=eval("("+request+")");jQuery("#checkDiv").html(jsRequest.body);jQuery("#checkDiv").show()},error:function(jqXHR,textStatus,errorThrown){jQuery(".aphpsSpinner").hide();alert("An error occurred!")}})}Calendar=function(){};Calendar.setup=function(a){bookingsDialog.find("#"+a.button).hide();a.daFormat=a.daFormat.replace("%d","dd");a.daFormat=a.daFormat.replace("%m","mm");a.daFormat=a.daFormat.replace("%y","yy");a.daFormat=a.daFormat.replace("%Y","yy");a.ifFormat=a.ifFormat.replace("%d","dd");a.ifFormat=a.ifFormat.replace("%m","mm");a.ifFormat=a.ifFormat.replace("%y","yy");a.ifFormat=a.ifFormat.replace("%Y","yy");bookingsDialog.find("#alt_"+a.inputField).datepicker({dateFormat:a.daFormat,altField:"#"+a.inputField,altFormat:a.ifFormat})};bookings.yearlyCalendarTopOffset=0;bookings.yearlyCalendarAdjustOffset=function(){};bookings.updateEndTime=function(){jQuery("#et").val(jQuery("#st").val()*1+jQuery("#timespan").val()*1);return true};jQuery(document).ready(function(){jQuery(".spinonsubmit").click(function(){jQuery(".aphpsSpinner").show()});jQuery("#book2-submit").click(function(){var a=0;jQuery(".productqty select").each(function(b){a=a+Number(jQuery(this).val())});if(a==0){alert("Please select one or more items you want to book");return false}else{return true}});if(jQuery("#timespan-custom").length>0){jQuery("#timespan").bind("change",this,function(){if(jQuery("#timespan").val()==0){jQuery("#timespan-custom").show()}else{jQuery("#timespan-custom").hide()}})}if((jQuery("#bookings .button").length>0)&&jQuery.isFunction(jQuery.fn.button)){jQuery("#bookings .button").button()}if((typeof bookingsAutoScrollPage!=="undefined")&&bookingsAutoScrollPage&&jQuery("#bookings").length>0){jQuery("html, body").animate({scrollTop:jQuery("#bookings").offset().top-30},0)}if(jQuery("#rescalendar_year_wrapper").length>0){jQuery("#rescalendar_year_wrapper").scrollTop(0);jQuery("#rescalendar_year_wrapper").scrollLeft(0);bookings.yearlyCalendarOffset=jQuery(".rescalendar_year_head").offset();bookings.windowScrollTopOffset=jQuery(window).scrollTop();bookings.oriTop=bookings.yearlyCalendarOffset.top+jQuery(window).scrollTop()-bookings.windowScrollTopOffset;bookings.tableScrollLeftOffset=jQuery("#rescalendar_year_wrapper").scrollLeft();bookings.tableOffset=jQuery(".rescalendar_year_headcol").offset();jQuery("#rescalendar_year_wrapper").scroll(function(){bookings.yearlyCalendarOffset=jQuery(".rescalendar_year_head").offset();bookings.windowScrollTopOffset=jQuery(window).scrollTop();jQuery(".rescalendar_year_head").offset({top:bookings.oriTop});if(jQuery.browser.mozilla==true){var a=bookings.tableOffset.left}else{var a=bookings.tableOffset.left+jQuery("#rescalendar_year_wrapper").scrollLeft()-bookings.tableScrollLeftOffset}jQuery(".rescalendar_year_headcol").offset({left:a})})}bookingsRewriteReservationLinks()});jQuery.fn.extend({getUrlParam:function(f){f=escape(unescape(f));var e=new Array();var b=null;if(jQuery(this).attr("nodeName")=="#document"){if(window.location.search.search(f)>-1){b=window.location.search.substr(1,window.location.search.length).split("&")}}else{if(jQuery(this).attr("src")!="undefined"){var d=jQuery(this).attr("src");if(d.indexOf("?")>-1){var a=d.substr(d.indexOf("?")+1);b=a.split("&")}}else{if(jQuery(this).attr("href")!="undefined"){var d=jQuery(this).attr("href");if(d.indexOf("?")>-1){var a=d.substr(d.indexOf("?")+1);b=a.split("&")}}else{return null}}}if(b==null){return null}for(var c=0;c<b.length;c++){if(escape(unescape(b[c].split("=")[0]))==f){e.push(b[c].split("=")[1])}}if(e.length==0){return null}else{if(e.length==1){return e[0]}else{return e}}}});